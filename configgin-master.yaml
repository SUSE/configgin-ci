resources:
- name: src
  type: git
  source:
    uri: git@github.com:hpcloud/hcf-configgin.git
    branch: master
    private_key: {{git-private-key}}
- name: src-ci
  type: git
  source:
    uri: git@github.com:hpcloud/hcf-configgin-ci.git
    branch: develop
    private_key: {{git-private-key}}
- name: swift.hcf-ci-concourse-configgin
  type: swift
  source:
    auth_url: {{swift-auth-url}}
    username: {{swift-access-key}}
    api_key: {{swift-secret-key}}
    domain: {{swift-domain}}
    tenant_id: {{swift-tenant-id}}
    container: hcf-ci-concourse-configgin
    regex: 'configgin-(.*)\.tgz'
jobs:
- name: lint
  plan:
  - aggregate:
    - get: src-ci
      trigger: true
    - get: src
      trigger: true
  - task: lint
    file: src-ci/tasks/lint.yaml
- name: test
  plan:
  - aggregate:
    - get: src
      trigger: true
    - get: src-ci
      trigger: true
  - task: test
    file: src-ci/tasks/test.yaml
- name: dist
  plan:
  - aggregate:
    - get: src
      passed: [lint, test]
      trigger: true
    - get: src-ci
      passed: [lint, test]
      trigger: true
  - task: dist
    file: src-ci/tasks/dist.yaml
  - put: swift.hcf-ci-concourse-configgin
    params:
      from: 'dist/configgin-(.*)\.tgz'
